<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="FactoryReorderReportDLC" pageWidth="612" pageHeight="792" whenNoDataType="AllSectionsNoDetail" columnWidth="552" leftMargin="30" rightMargin="30" topMargin="20" bottomMargin="20" uuid="9731d4f9-2aba-4200-87c1-016c52941e74">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0980750000000004"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<style name="9" fontName="Open Sans" fontSize="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10" isDefault="true" fontName="Open Sans" fontSize="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="14" fontName="Open Sans" fontSize="14" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10b" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12b" fontName="Open Sans" fontSize="12" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="14b" fontName="Open Sans" fontSize="14" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="16b" fontName="Open Sans" fontSize="16" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="18b" fontName="Open Sans" fontSize="18" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="24b" fontName="Open Sans" fontSize="24" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10i" fontName="Open Sans" fontSize="10" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12i" fontName="Open Sans" fontSize="12" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10bu" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="true" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header1" fontName="Open Sans" fontSize="24" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header2" fontName="Open Sans" fontSize="18" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header3" fontName="Open Sans" fontSize="16" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="addressHeader" fontName="Open Sans" fontSize="14" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="date" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="type" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="address" fontName="Open Sans" fontSize="10" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="column_head" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="body" isDefault="true" fontName="Open Sans" fontSize="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="note" isDefault="true" fontName="Open Sans" fontSize="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="Zebra" fontName="Open Sans">
		<box leftPadding="3" rightPadding="3">
			<leftPen lineWidth="1.0" lineColor="#FFFFFF"/>
			<rightPen lineWidth="1.0" lineColor="#FFFFFF"/>
		</box>
		<conditionalStyle>
			<conditionExpression><![CDATA[$V{COLUMN_COUNT} % 2 == 0]]></conditionExpression>
			<style mode="Opaque" backcolor="#EAEAEA"/>
		</conditionalStyle>
	</style>
	<subDataset name="SOInfo" uuid="29eac9f8-4a7f-448b-8838-de79603785e9">
		<parameter name="path" class="java.lang.String" isForPrompting="false">
			<defaultValueExpression><![CDATA["C:/Program Files/Fishbowl/Server/reports/WorkOrder/"]]></defaultValueExpression>
		</parameter>
		<parameter name="module" class="java.lang.Object" isForPrompting="false">
			<defaultValueExpression><![CDATA[null]]></defaultValueExpression>
		</parameter>
		<parameter name="cbApplyDateFilter" class="java.lang.String" isForPrompting="false">
			<property name="Group" value="Select a date field and enter a date range"/>
			<property name="Sort" value="2"/>
			<parameterDescription><![CDATA[so.datefirstship,Scheduled Fulfillment Date,so.datecreated,Date Created,so.dateissued,Date Issued,so.datecompleted,SO Date Completed,so.datelastmodified,Date Last Changed,soitem.dateLastFulfillment,SO Item Date Fulfilled]]></parameterDescription>
			<defaultValueExpression><![CDATA["so.datefirstship"]]></defaultValueExpression>
		</parameter>
		<queryString>
			<![CDATA[SELECT
product.num AS PRODUCT,
soldResult.QTYSOLD,
bidResult.QTYONBID,
poResult.QTYONPO,
qtyAvailableResult.QTYAVAILABLE,
COALESCE(soldResult.QTYSOLD,0) -
COALESCE(bidResult.QTYONBID,0) -
COALESCE(poResult.QTYONPO,0) -
COALESCE(qtyAvailableResult.QTYAVAILABLE,0) AS QTYREORDER
FROM product
INNER JOIN part ON part.id = product.partId
LEFT OUTER JOIN (
  	select soitem.productid, sum(soitem.qtyOrdered) AS QTYSOLD from soitem
	INNER JOIN so ON so.id = soitem.soid
	WHERE  so.statusId IN (20,25,60, 70) AND $P!{cbApplyDateFilter} BETWEEN DATE_SUB(CURDATE(), INTERVAL 180 DAY) AND CURDATE()
	GROUP BY soitem.productId
) AS soldResult ON soldResult.productId = product.id

LEFT OUTER JOIN (
	SELECT product.id AS productId, poitem.partid, sum(poitem.qtyToFulfill) AS QTYONBID FROM po
	INNER JOIN poitem ON poitem.poid = po.id
	INNER JOIN product ON product.partId = poitem.partid
	WHERE po.statusId = 10
	GROUP BY productId, poitem.partid
) AS bidResult ON bidResult.productId = product.id


LEFT OUTER JOIN (
	SELECT product.id AS productId, qtyonorderpo.partid, sum(qty) AS QTYONPO FROM qtyonorderpo
	INNER JOIN product ON product.partId = qtyonorderpo.partid
	GROUP BY productId, partid
) AS poResult ON poResult.productId = product.id


LEFT OUTER JOIN (
	SELECT product.id AS productId, qtyinventorytotals.partid AS partId,
(SUM(QTYINVENTORYTOTALS.QTYONHAND) - SUM(QTYINVENTORYTOTALS.QTYALLOCATED) - SUM(QTYINVENTORYTOTALS.QTYNOTAVAILABLE) + SUM(QTYINVENTORYTOTALS.QTYDROPSHIP)) AS QTYAVAILABLE
FROM qtyinventorytotals
INNER JOIN part ON part.id = qtyinventorytotals.partid
INNER JOIN product ON product.partId = part.id
WHERE part.activeFlag = 1
GROUP BY productId, partId) AS qtyAvailableResult ON qtyAvailableResult.productId = product.id
WHERE product.activeFlag = 1 AND part.typeId = 10
ORDER BY 1;


]]>
		</queryString>
		<field name="PRODUCT" class="java.lang.String"/>
		<field name="QTYSOLD" class="java.lang.Double"/>
		<field name="QTYONBID" class="java.lang.Double"/>
		<field name="QTYONPO" class="java.lang.Double"/>
		<field name="QTYAVAILABLE" class="java.lang.Double"/>
		<field name="QTYREORDER" class="java.lang.Double"/>
		<variable name="QtyDecimal" class="java.lang.String" resetType="None">
			<variableExpression><![CDATA[System.getProperty("REPORT_DECIMAL_QTY")]]></variableExpression>
		</variable>
	</subDataset>
	<parameter name="path" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["../SalesOrder/"]]></defaultValueExpression>
	</parameter>
	<parameter name="module" class="java.lang.Object" isForPrompting="false">
		<defaultValueExpression><![CDATA[null]]></defaultValueExpression>
	</parameter>
	<parameter name="ReportTitle" class="java.lang.String" isForPrompting="false"/>
	<parameter name="cbApplyDateFilter" class="java.lang.String" isForPrompting="false">
		<property name="Group" value="Select a date field and enter a date range"/>
		<property name="Sort" value="2"/>
		<parameterDescription><![CDATA[so.datecreated,Date Created,so.dateissued,Date Issued]]></parameterDescription>
		<defaultValueExpression><![CDATA["so.dateissued"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT



    COMPANY.NAME AS COMPANY


FROM company WHERE company.id = 1]]>
	</queryString>
	<field name="COMPANY" class="java.lang.String"/>
	<variable name="DateFormat" class="java.lang.String" resetType="None">
		<variableExpression><![CDATA[(System.getProperty("REPORT_DATE_FORMAT"))]]></variableExpression>
	</variable>
	<group name="Product">
		<groupHeader>
			<band height="70">
				<componentElement>
					<reportElement key="Show Details" x="0" y="0" width="552" height="70" uuid="e11c224c-9d17-4b99-899d-f6daec39b0ce"/>
					<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
						<datasetRun subDataset="SOInfo" uuid="174a256f-90c8-43cf-ba80-c495d91396e2">
							<parametersMapExpression><![CDATA[$P{REPORT_PARAMETERS_MAP}]]></parametersMapExpression>
							<datasetParameter name="cbApplyDateFilter">
								<datasetParameterExpression><![CDATA[$P{cbApplyDateFilter}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:column width="110" uuid="2240178e-6507-4adc-b226-1fd1a8b05d47">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="110" height="30" uuid="f6dbd403-0753-4d65-b67b-9be3c99a6ddc"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[Product]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="110" height="13" isPrintWhenDetailOverflows="true" uuid="9563e92d-384f-49d3-aed7-546f0342d362"/>
									<box leftPadding="3" rightPadding="0"/>
									<textElement>
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{PRODUCT}]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="90" uuid="2240178e-6507-4adc-b226-1fd1a8b05d47">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="30" uuid="f6dbd403-0753-4d65-b67b-9be3c99a6ddc"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement textAlignment="Center" verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[ Qty Sold Last 180 Days]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="13" isPrintWhenDetailOverflows="true" uuid="9563e92d-384f-49d3-aed7-546f0342d362"/>
									<box leftPadding="1" rightPadding="1"/>
									<textElement textAlignment="Center">
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{QTYSOLD}]]></textFieldExpression>
									<patternExpression><![CDATA[$V{QtyDecimal}]]></patternExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="80" uuid="a8579e53-e22d-4b72-a987-4679f85a3f4d">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="80" height="30" uuid="f381c805-bd84-4d96-bb68-de5c6f0e7261"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement textAlignment="Center" verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[ Qty On Bid]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="80" height="13" isPrintWhenDetailOverflows="true" uuid="54a43db6-790c-401e-8880-853d42f8852b"/>
									<box leftPadding="1" rightPadding="1"/>
									<textElement textAlignment="Center">
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{QTYONBID}]]></textFieldExpression>
									<patternExpression><![CDATA[$V{QtyDecimal}]]></patternExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="80" uuid="a8579e53-e22d-4b72-a987-4679f85a3f4d">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="80" height="30" uuid="f381c805-bd84-4d96-bb68-de5c6f0e7261"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement textAlignment="Center" verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[ Qty On PO]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="80" height="13" isPrintWhenDetailOverflows="true" uuid="54a43db6-790c-401e-8880-853d42f8852b"/>
									<box leftPadding="1" rightPadding="1"/>
									<textElement textAlignment="Center">
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{QTYONPO}]]></textFieldExpression>
									<patternExpression><![CDATA[$V{QtyDecimal}]]></patternExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="90" uuid="a8579e53-e22d-4b72-a987-4679f85a3f4d">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="30" uuid="f381c805-bd84-4d96-bb68-de5c6f0e7261"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement textAlignment="Center" verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[ Qty Available]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="13" isPrintWhenDetailOverflows="true" uuid="54a43db6-790c-401e-8880-853d42f8852b"/>
									<box leftPadding="1" rightPadding="1"/>
									<textElement textAlignment="Center">
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{QTYAVAILABLE}]]></textFieldExpression>
									<patternExpression><![CDATA[$V{QtyDecimal}]]></patternExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
						<jr:column width="90" uuid="a8579e53-e22d-4b72-a987-4679f85a3f4d">
							<jr:columnHeader height="30" rowSpan="1">
								<staticText>
									<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="30" uuid="f381c805-bd84-4d96-bb68-de5c6f0e7261"/>
									<box leftPadding="3" rightPadding="0">
										<bottomPen lineWidth="1.0"/>
									</box>
									<textElement textAlignment="Center" verticalAlignment="Bottom">
										<font fontName="Open Sans" size="10" isBold="true"/>
									</textElement>
									<text><![CDATA[Reorder Qty]]></text>
								</staticText>
							</jr:columnHeader>
							<jr:detailCell height="13" rowSpan="1">
								<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
									<reportElement style="Zebra" stretchType="RelativeToBandHeight" x="0" y="0" width="90" height="13" isPrintWhenDetailOverflows="true" uuid="54a43db6-790c-401e-8880-853d42f8852b"/>
									<box leftPadding="1" rightPadding="1"/>
									<textElement textAlignment="Center">
										<font fontName="Open Sans" size="9"/>
									</textElement>
									<textFieldExpression><![CDATA[$F{QTYREORDER}]]></textFieldExpression>
									<patternExpression><![CDATA[$V{QtyDecimal}]]></patternExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
					</jr:table>
				</componentElement>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="54">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement key="" x="0" y="0" width="552" height="18" uuid="b7660593-24c6-41c9-be4e-4cfa2a54e7b7"/>
				<box leftPadding="3" rightPadding="3"/>
				<textElement>
					<font fontName="Open Sans" size="13" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{COMPANY}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement key="" mode="Transparent" x="0" y="18" width="552" height="22" forecolor="#000000" backcolor="#FFFFFF" uuid="e80b44fd-3fa4-4ac8-a24e-60abb9bc410f"/>
				<box leftPadding="3"/>
				<textElement verticalAlignment="Middle" rotation="None" markup="none">
					<font fontName="Open Sans" size="16" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{ReportTitle}.equals("%") ? "Factory Reorder Report" : $P{ReportTitle}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement key="" mode="Transparent" x="0" y="40" width="552" height="14" forecolor="#000000" backcolor="#FFFFFF" uuid="2b09cc6b-ec8a-4a73-99c3-4ce8a095c51e">
					<printWhenExpression><![CDATA[true]]></printWhenExpression>
				</reportElement>
				<box leftPadding="3" rightPadding="3">
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#FFFFFF"/>
				</box>
				<textElement verticalAlignment="Bottom" rotation="None">
					<font fontName="Open Sans" size="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
					<paragraph lineSpacing="Single"/>
				</textElement>
				<textFieldExpression><![CDATA[]]></textFieldExpression>
			</textField>
		</band>
	</title>
</jasperReport>
